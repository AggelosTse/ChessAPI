<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chess Time Range UI</title>
  <style>
    body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #1e1e2f, #2c2c44);
        color: white;
        padding: 40px;
    }

    .card {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 25px;
        width: 350px;
        margin: auto;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        backdrop-filter: blur(12px);
        animation: fadeIn 0.6s ease;
    }

    label {
        font-size: 14px;
        opacity: 0.8;
    }

    input, select {
        width: 100%;
        margin-top: 6px;
        margin-bottom: 18px;
        padding: 10px;
        border-radius: 10px;
        border: none;
        outline: none;
        font-size: 15px;
        background: rgba(255,255,255,0.12);
        color: white;
        transition: 0.3s;
    }

    input:focus, select:focus {
        background: rgba(255,255,255,0.18);
        transform: scale(1.02);
    }

    .button {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        border: none;
        background: #5f5df0;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
        animation: fadeIn 0.6s ease;
    }

    .button:hover {
        background: #4846d6;
        transform: scale(1.05);
        box-shadow: 0 6px 18px rgba(80,80,255,0.4);
    }

    .fade {
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="card">
      <label>Chess.com Username</label>
      <input type="text" id="name" placeholder="Enter your username">

      <label>Time Category</label>
      <select id="mainOption">
          <option value="">-- Select Time Range --</option>
          <option value="Days">Days</option>
          <option value="Months">Months</option>
          <option value="Years">Years</option>
      </select>

      <div id="subOptionsContainer"></div>
      <div id="submitContainer"></div>
  </div>

  <script type="module">
    // Use dynamic import so the script won't block execution if utils.js can't be loaded
    // (useful when opening file:// or during dev without a server).
    // If the real utils.js is available, it should provide `nextPhase(name, main, sub)`.
    let nextPhase = (name, main, sub) => {
      // fallback behavior if utils.js isn't loaded
      alert(`(fallback) nextPhase called with:\nusername=${name}\nrange=${main}\namount=${sub}`);
    };

    (async () => {
      try {
        // Attempt to load the real utils module
        const mod = await import('./utils.js');
        if (mod && typeof mod.nextPhase === 'function') {
          nextPhase = mod.nextPhase;
        } else {
          console.warn('utils.js loaded but did not export nextPhase — using fallback.');
        }
      } catch (err) {
        // Common when opening file:// pages — dynamic import will fail due to CORS or file restrictions.
        console.warn('Could not load ./utils.js (caught):', err);
        // Keep using the fallback nextPhase defined above.
      }

      // --- UI logic (module-scoped) ---

      function resetAll() {
          document.getElementById("subOptionsContainer").innerHTML = "";
          document.getElementById("submitContainer").innerHTML = "";
      }

      function showSubOptions() {
          resetAll();

          const mainOption = document.getElementById("mainOption").value;
          if (!mainOption) return;

          const container = document.getElementById("subOptionsContainer");

          const label = document.createElement("label");
          label.textContent = mainOption + " Amount";
          label.classList.add("fade");

          const select = document.createElement("select");
          select.id = "subSelect";
          select.classList.add("fade");

          let options = [];

          if (mainOption === "Days") {
              options = [1, 3, 7, 14, 21, 30];
          } 
          else if (mainOption === "Months") {
              options = [1, 2, 3, 6, 9, 12];
          }
          else if (mainOption === "Years") {
              options = [1, 2, 3, 5, 10];
          }

          options.forEach(value => {
              const option = document.createElement("option");
              option.value = value;
              option.textContent = value;
              select.appendChild(option);
          });

          container.appendChild(label);
          container.appendChild(select);

          const submitBtn = document.createElement("button");
          submitBtn.textContent = "Submit";
          submitBtn.classList.add("button");
          submitBtn.onclick = handleSubmit;

          document.getElementById("submitContainer").appendChild(submitBtn);
      }

      function handleSubmit(event) {
          event.preventDefault();

          const name = document.getElementById("name").value;
          const mainOption = document.getElementById("mainOption").value;
          const subSelect = document.getElementById("subSelect");
          const subOption = subSelect ? subSelect.value : "";

          if (!name.trim()) {
              alert("Please enter your Chess.com username.");
              return;
          }

          // call the real or fallback nextPhase
          try {
            nextPhase(name, mainOption, subOption);
          } catch (e) {
            console.error('Error calling nextPhase:', e);
            alert('An error occurred while proceeding. Check console for details.');
          }
      }

      // Attach listener (fixes inline event / ES module issues)
      document.getElementById("mainOption").addEventListener("change", showSubOptions);

    })(); // end async IIFE
  </script>
</body>
</html>
